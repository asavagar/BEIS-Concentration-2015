theme_set(theme_bw()) # set the ggplot2 theme to black and white
# Chunk 2: UK Weighted Concentration
HHI <- dt %>%
group_by(year) %>%
summarise(
HHIw = weighted.mean(hhi, turnoverbn, na.rm = TRUE),
HHIs = mean(hhi, na.rm = TRUE)
)
HHI_plot <- ggplot() +
geom_line(data = HHI, mapping = aes(x = year, y = HHIw, color = "red"), size = 1.2) +
geom_point(data = HHI, mapping = aes(x = year, y = HHIw), size = 4.5) +
geom_line(data = HHI, mapping = aes(x = year, y = HHIs, color = "darkblue"), size = 1,
linetype = "dashed") +
geom_point(data = HHI, mapping = aes(x = year, y = HHIs), size = 3, shape = 17) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Concentration (HHI)") +
scale_color_discrete(name = "", labels = c("Simple Avg.", "Weighted"))
plot(HHI_plot)
# Chunk 3: HHI Distributions
dt %>%
filter(year == 2006 | year == 2010 | year == 2015) %>%
ggplot() +
geom_histogram(aes(x = hhi, group = year), color = "navy", fill = "white") +
geom_density(aes(x = hhi, group = year), adjust = 2) +
facet_grid(~year) +
ylab("Frequency") +
xlab("Herfindahl Index")
# Chunk 4: Sector HHI Time Series Comparison
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
# Chunk 5: Sector HHI Full Period Average
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(
x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)
), color = "skyblue", size = 2) +
geom_point(color = "blue", size = 4, alpha = 0.6) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
# Chunk 6: Concentration Ratios Average over Time
dt %>%
select(sector, year, sic1, top05ms, top10ms, top15ms) %>%
mutate(CR5 = top05ms, CR10 = top10ms, CR15 = top15ms) %>%
select(sector, year, sic1, CR5, CR10, CR15) %>%
gather(key = CR, value = value, c(CR5, CR10, CR15)) %>%
group_by(year, CR) %>%
summarise(value = mean(value, na.rm = TRUE)) %>%
ggplot(aes(x = year, y = value, fill = CR)) +
geom_bar(stat = "identity", position = position_dodge()) +
scale_fill_brewer(palette = "Paired") +
scale_x_discrete(
name = "Year",
limits = c(
2006, 2007, 2008, 2009, 2010,
2011, 2012, 2013, 2014, 2015
)
) +
scale_y_continuous(name = "Market Share(%)")
# Chunk 7: Manufacturing HHI time series
dt %>%
filter(sic1 == "C") %>%
ggplot() +
geom_line(mapping = aes(x = year, y = hhi), color = "darkred") +
geom_point(mapping = aes(x = year, y = hhi), size = 2) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Manufacturing HHI")
# Chunk 8: Retail/wholesale HHI time series
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
filter(sic1 == "G") %>%
ggplot() +
geom_line(mapping = aes(x = year, y = sic1hhi), color = "darkblue") +
geom_point(mapping = aes(x = year, y = sic1hhi), size = 2) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Retail/wholesale HHI")
# Chunk 9: Agricultural HHI time series
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
filter(sic1 == "A") %>%
ggplot() +
geom_line(mapping = aes(x = year, y = sic1hhi), color = "darkgreen") +
geom_point(mapping = aes(x = year, y = sic1hhi), size = 2) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Agricultural HHI")
# Chunk 10: Average Net Entry time series
dt %>%
filter(year > 2006 & year < 2015) %>%
group_by(year) %>%
mutate(netentryratio = ((entrynbr - exitnbr) / firmnbr) * 100) %>%
summarise(netentryratio = weighted.mean(netentryratio, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(mapping = aes(x = year, y = netentryratio), color = "darkblue") +
geom_point(mapping = aes(x = year, y = netentryratio), size = 2) +
scale_x_discrete(
name = "Year",
limits = c(2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015)
) +
scale_y_continuous(name = "Net Entry Rate")
# Chunk 11: Average Entry rate time series
dt %>%
filter(year > 2006 & year < 2015) %>%
group_by(year) %>%
mutate(entryratio = (entrynbr / firmnbr) * 100) %>%
summarise(entryratio = weighted.mean(entryratio, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(mapping = aes(x = year, y = entryratio), color = "darkgreen") +
geom_point(mapping = aes(x = year, y = entryratio), size = 2) +
scale_x_discrete(
name = "Year",
limits = c(2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015)
) +
scale_y_continuous(name = "Entry Rate")
# Chunk 12: Average Exit Rate time series
dt %>%
filter(year > 2006 & year < 2015) %>%
group_by(year) %>%
mutate(exitratio = (exitnbr / firmnbr) * 100) %>%
summarise(exitratio = weighted.mean(exitratio, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(mapping = aes(x = year, y = exitratio), color = "darkgreen") +
geom_point(mapping = aes(x = year, y = exitratio), size = 2) +
scale_x_discrete(
name = "Year",
limits = c(2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015)
) +
scale_y_continuous(name = "Exit Rate")
# Chunk 13: Net Entry HHI Correlation
dt %>%
mutate(netentryratio = ((entrynbr - exitnbr) / firmnbr) * 100) %>%
filter(netentryratio > -20 & netentryratio < 50) %>%
ggplot() +
geom_point(aes(x = netentryratio, y = hhi), shape = 1, size = 3) +
geom_smooth(aes(x = netentryratio, y = hhi), method = "lm", se = FALSE)
# Chunk 14: Selected Sector Net Entry HHI Relationship
dt %>%
filter(sic1 == "C" | sic1 == "G" | sic1 == "A") %>%
mutate(netentryratio = ((entrynbr - exitnbr) / firmnbr) * 100) %>%
filter(netentryratio < 70) %>%
ggplot() +
geom_point(aes(x = netentryratio, y = hhi, color = sic1), size = 3) +
geom_smooth(aes(x = netentryratio, y = hhi), method = "lm", se = FALSE)
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name, ncol=4, labeller = labeller(sic1name = label_wrap_gen(width = 30))) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name, ncol=4, labeller = labeller(sic1name = label_wrap_gen(width = 20))) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
getwd()
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name, ncol=4, labeller = labeller(sic1name = label_wrap_gen(width = 20))) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
ggsave("HHI_by_sector.png", width = 50, height = 50, units = "cm")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name, ncol=4, labeller = labeller(sic1name = label_wrap_gen(width = 20))) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
ggsave("HHI_by_sector.png", width = 30, height = 30, units = "cm")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name, ncol=4, labeller = labeller(sic1name = label_wrap_gen(width = 30))) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
ggsave("HHI_by_sector.png", width = 20, height = 20, units = "cm")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name, ncol=4, labeller = labeller(sic1name = label_wrap_gen(width = 30))) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
ggsave("HHI_by_sector.png", width = 25, height = 20, units = "cm")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name, ncol=4, labeller = labeller(sic1name = label_wrap_gen(width = 35))) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
ggsave("HHI_by_sector.png", width = 25, height = 25, units = "cm")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name, ncol=4, labeller = labeller(sic1name = label_wrap_gen(width = 30))) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
ggsave("HHI_by_sector.png", width = 25, height = 25, units = "cm")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
geom_point(color = "blue", size = 4, alpha = 0.6) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
geom_point(color = "blue", size = 4, alpha = 0.6) +
theme_light() +
# coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
dt
dt$sector
dt$sector <- strwrap(dt$sector, width = 25)
dt$sector <- strwrap(dt$sector, width = 35)
strwrap(dt$sector, width = 35)
strwrap(dt$sector, width = 5)
strwrap(dt$sector, width = 50)
strwrap(dt$sector, width = 20)
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
geom_point(color = "blue", size = 4, alpha = 0.6) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
geom_point(color = "blue", size = 4, alpha = 0.6) +
scale_x_discrete(labels = function(sic1name) str_wrap(sic1name, width = 10)) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
geom_point(color = "blue", size = 4, alpha = 0.6) +
scale_x_discrete(labels = function(sic1name) str_wrap(sic1name, width = 20)) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
geom_point(color = "blue", size = 4, alpha = 0.6) +
scale_x_discrete(labels = function(sic1name) str_wrap(sic1name, width = 30)) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
geom_point(color = "blue", size = 4, alpha = 0.6) +
scale_x_discrete(labels = function(sic1name) str_wrap(sic1name, width = 40)) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
# geom_point(color = "blue", size = 4, alpha = 0.6) +
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
# geom_point(color = "blue", size = 4, alpha = 0.6) +
scale_x_discrete(labels = function(sic1name) str_wrap(sic1name, width = 40)) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
# geom_point(color = "blue", size = 4, alpha = 0.6) +
scale_x_discrete(labels = function(sic1name) str_wrap(sic1name, width = 35)) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
# geom_point(color = "blue", size = 4, alpha = 0.6) +
scale_x_discrete(labels = function(sic1name) str_wrap(sic1name, width = 37)) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
arrange(sic1hhi) %>%
mutate(sic1name = factor(sic1name, sic1name)) %>%
ggplot(aes(x = sic1name, y = sic1hhi)) +
geom_segment(aes(x = sic1name, xend = sic1name, y = 0, yend = sic1hhi,
size = I(10)), color = "skyblue", size = 2) +
geom_point(color = "blue", size = 4, alpha = 0.6) +
scale_x_discrete(labels = function(sic1name) str_wrap(sic1name, width = 37)) +
theme_light() +
coord_flip() +
theme(
panel.grid.major.y = element_blank(),
panel.border = element_blank(),
axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Average Herfindahl Index")
It is easier to save the image by setting dimensions and then print it:
![HHI by Sector](HHI_by_sector.png)
dt %>%
filter(sic1name != "NA") %>%
group_by(sic1name, year) %>%
summarise(sic1hhi = weighted.mean(hhi, turnoverbn, na.rm = TRUE)) %>%
ggplot() +
geom_line(
mapping = aes(x = year, y = sic1hhi), linetype = "twodash",
size = 1.2, color = "red"
) +
facet_wrap(~sic1name, ncol=4, labeller = labeller(sic1name = label_wrap_gen(width = 30))) +
scale_x_discrete(name = "Year", limits = c(2006, 2009, 2012, 2015)) +
scale_y_continuous(name = "Herfindahl Index")
ggsave("HHI_by_sector.png", width = 25, height = 25, units = "cm")
